// Collection library under The MIT License (MIT) - Copyright (c) 2015 Brice Leroy <bbrriiccee@gmail.com>
function Collection(_models,primary_key){var models=[];var index={};primary_key=primary_key||'id';if(_models){add(_models)}function size(){return models.length}function isEmpty(){return models.length===0}function empty(){models=[];index={}}function each(callback){var r,i,result=[];for(r=i=0;r!==false&&i<models.length;i++){r=callback(models[i],i);if(r)result.push(r)}return result}function filter(callback){var r=[],position=0;each(function(model,position){if(callback(model,models,position)){r.push(model)}});return new Collection(r)}function remove(attribute,value){if(arguments.length===1){value=attribute;attribute=primary_key}for(var i=0;i<models.length;i++){if(models[i][attribute]===value){delete index[models[i][primary_key]];models.splice(i,1);i=i-1}}return this}function where(select){var r=[];each(function(model){var match=true;for(var key in select){if(typeof select[key]==='function'){if(!select[key](model[key]))match=false}else if(Array.isArray(select[key])){var sub_match=false;for(var i=0;i<select[key].length;i++){if(select[key][i]===model[key])sub_match=true}match=match&&sub_match}else{if(select[key]!==model[key])match=false}}if(match)r.push(model)});return new Collection(r)}function select(names){var result=[];if(typeof names==='string'){each(function(model){result.push(model[names])})}else{each(function(model){var values={};for(var i=0;i<names.length;i++){values[names[i]]=model[names[i]]}result.push(values)})}return result}function reverse(){models.reverse();return this}function sort(attribute,callback){var _models=[].concat(models);if(callback){_models.sort(function(a,b){return callback(a[attribute],b[attribute])})}else{_models.sort(function(a,b){var v_a=a[attribute];var v_b=b[attribute];if(v_a===v_b)return 0;if(v_b===[v_b,v_a].sort()[0])return 1;return-1})}return Collection(_models)}function get(attribute,value){if(arguments.length===1||attribute===primary_key){return index[attribute]}var r=null;each(function(model){if(model.hasOwnProperty(attribute)&&model[attribute]==value){r=model;return false}});return r}function add(_models){_models=[].concat(_models);var model;for(var i=0;i<_models.length;i++){model=_models[i];remove(model[primary_key]);models.push(model);index[model[primary_key]]=model}}function _interpolate_uuid(char){var r=Math.random()*16|0,v=char=='x'?r:(r&0x3|0x8);return v.toString(16)}function uuid(){var uuid_format='xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx';return uuid_format.replace(/[xy]/g,_interpolate_uuid)}return{'uuid':uuid,'isEmpty':isEmpty,'empty':empty,'size':size,'models':models,'add':add,'filter':filter,'each':each,'where':where,'select':select,'sort':sort,'get':get,'remove':remove,'reverse':reverse}}
