// under MIT License (c) 2015 Brice Leroy <bbrriiccee@gmail.com>
function Collection(e,t){function i(){return n.length}function s(){return n.length===0}function o(){n=[];r={}}function u(e){var t,r,i=[];for(t=r=0;t!==false&&r<n.length;r++){t=e(n[r],r);if(t)i.push(t)}return i}function a(e){var t=[],r=0;u(function(r,i){if(e(r,n,i)){t.push(r)}});return new Collection(t)}function f(e,i){if(arguments.length===1){i=e;e=t}for(var s=0;s<n.length;s++){if(n[s][e]===i){delete r[n[s][t]];n.splice(s,1);s=s-1}}return this}function l(e){var t=[];u(function(n){var r=true;for(var i in e){if(typeof e[i]==="function"){if(!e[i](n[i]))r=false}else if(Array.isArray(e[i])){var s=false;for(var o=0;o<e[i].length;o++){if(e[i][o]===n[i])s=true}r=r&&s}else{if(e[i]!==n[i])r=false}}if(r)t.push(n)});return new Collection(t)}function c(e){var t=new RegExp(e,"gi");return function(e){return t.test(e)}}function h(e){var t=e.split(" ");var n=new RegExp(t.join("[^\\s]*\\s.*"),"gi");return function(e){return n.test(e)}}function p(e){return function(t){return t<=e}}function d(e){return function(t){return t>=e}}function v(e,t){return function(n){return n>=Math.min(e,t)&&n<=Math.max(e,t)}}function m(e){var t=[];if(typeof e==="string"){u(function(n){t.push(n[e])})}else{u(function(n){var r={};for(var i=0;i<e.length;i++){r[e[i]]=n[e[i]]}t.push(r)})}return t}function g(){n.reverse();return this}function y(e,t){var r=[].concat(n);if(t){r.sort(function(n,r){return t(n[e],r[e])})}else{r.sort(function(t,n){var r=t[e];var i=n[e];if(r===i)return 0;if(i===[i,r].sort()[0])return 1;return-1})}return new Collection(r)}function b(e,n){if(arguments.length===1||e===t){return r[e]}var i=null;u(function(t){if(t.hasOwnProperty(e)&&t[e]==n){i=t;return false}});return i}function w(e){e=[].concat(e);var i;for(var s=0;s<e.length;s++){i=e[s];f(i[t]);n.push(i);r[i[t]]=i}}function E(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)}function S(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";return e.replace(/[xy]/g,E)}var n=[];var r={};t=t||"id";if(e){w(e)}return{uuid:S,isEmpty:s,empty:o,size:i,models:n,add:w,filter:a,each:u,where:l,min:d,max:p,within:v,contains:c,fuzzy:h,select:m,sort:y,get:b,remove:f,reverse:g}}
